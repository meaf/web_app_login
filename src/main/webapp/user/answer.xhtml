<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:tp="http://java.sun.com/jsf/composite/toolbox">
<h:head>
    <link type="text/css" rel="stylesheet" href="${pageContext.request.contextPath}/resources/styles.css"/>
    <title>Answer</title>
</h:head>
<h:body>
    <p:growl id="growl" showDetail="true" life="1000"/>
    <div class="surveyTable">
        <tp:header/>
        <h:form>
            <c:set var="id" value="#{param['id']}"/>
            <c:set var="currElement" value="#{navigationBean.questionById(id)}"/>

            #{managingBean.setManagedQuestion(currElement)}
            #{managingBean.answerQuestionUser(managingBean.managedQuestion)}

            <p:outputPanel style="display:block" rendered="#{sessionBean.userExpert}" id="answerPanel">
                <h1 align="center"><p:outputLabel value="#{managingBean.managedQuestion.title}"/></h1>
                <h2 align="center"><p:outputLabel value="#{managingBean.managedQuestion.description}"/></h2>
                <h3 align="center"><p:outputLabel value="#{managingBean.managedAnswer.status}"/></h3>
                <p:outputLabel value="Ваша відповідь:"/><br/>

                <p:textEditor widgetVar="answerEditor" value="#{managingBean.managedAnswer.text}" height="300"
                              style="margin-bottom:10px; background-color: #f1f5f8" required="true"
                              readonly="#{!managingBean.getManagedAnswerEditable()}"/>

                <p:panelGrid columns="3" styleClass="transparentBG"
                             rendered="#{managingBean.getManagedAnswerEditable()}">
                    <p:commandButton value="Submit" update="growl" oncomplete="PF('confirmation').show()"/>
                    <p:commandButton value="Draft" action="#{managingBean.addAnswer(false)}"
                                     update="growl answerPanel"/>
                    <p:commandButton value="Clear" type="button" onclick="PF('answerEditor').clear();"/>
                </p:panelGrid>
            </p:outputPanel>


            <p:dialog header="Submit answer?" width="20%" resizable="false" closable="false"
                      modal="true" hideEffect="fade" showEffect="fade" widgetVar="confirmation">
                <h:panelGrid columns="2" width="90%">
                    <p:commandButton value="Submit" action="#{managingBean.addAnswer(true)}"
                                     update="growl answerPanel"
                                     oncomplete="PF('confirmation').hide()"/>
                    <p:commandButton value="Cancel" oncomplete="PF('confirmation').hide()"/>
                </h:panelGrid>
            </p:dialog>

            <!--// org list-->
            <p:outputPanel style="display:block" rendered="#{sessionBean.userOrganizer}">
                <p:accordionPanel var="answer"
                                  value="#{navigationBean.answersAllByQuestion(managingBean.managedQuestion)}"
                                  multiple="true">
                    <p:tab title="#{answer.user.userFullName}">
                        <h:panelGrid columns="1" cellpadding="3" width="100%" styleClass="hideToolbar borderless">
                            <p:outputLabel value="#{answer.status}"/>
                            <p:textEditor value="#{answer.text}"
                                          readonly="true"
                            />
                        </h:panelGrid>
                    </p:tab>
                </p:accordionPanel>
            </p:outputPanel>
        </h:form>
    </div>
</h:body>
</html>

